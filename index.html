case 'reaction':
    // Получаем CSS переменные
    const rootStyles = getComputedStyle(document.documentElement);
    const primaryColor = rootStyles.getPropertyValue('--primary-color').trim();
    const accentColor = rootStyles.getPropertyValue('--accent-color').trim();

    container.innerHTML = `
        <h2>Тест на реакцию</h2>
        <p>Нажмите на мишень, когда она изменит цвет. Попробуйте сделать это как можно быстрее!</p>
        <div id="reaction-target"></div>
        <div id="reaction-stats">
            <p>Последняя реакция: <span id="reaction-time">-</span> мс</p>
            <p>Лучшая реакция: <span id="reaction-best">${stats.reactionBestTime === Infinity ? '-' : stats.reactionBestTime}</span> мс</p>
            <p>Попыток: ${stats.reactionTotalTests}</p>
        </div>
        <button class="btn" id="reaction-start" style="margin-top: 20px;">Начать тест</button>
    `;
    
    const target = document.getElementById('reaction-target');
    const startBtn = document.getElementById('reaction-start');
    const reactionTime = document.getElementById('reaction-time');
    const reactionBest = document.getElementById('reaction-best');
    let startTime;
    let timeoutId;
    let isWaiting = false;
    
    startBtn.addEventListener('click', function() {
        if (isWaiting) return;
        
        this.disabled = true;
        isWaiting = true;
        target.style.backgroundColor = primaryColor;
        
        // Случайная задержка от 1 до 5 секунд
        const delay = 1000 + Math.random() * 4000;
        
        timeoutId = setTimeout(() => {
            target.style.backgroundColor = accentColor;
            startTime = Date.now();
        }, delay);
    });
    
    target.addEventListener('click', function() {
        if (!isWaiting || !startTime) return;
        
        // Если нажали слишком рано
        if (this.style.backgroundColor !== accentColor) {
            clearTimeout(timeoutId);
            reactionTime.textContent = 'Слишком рано!';
            startBtn.disabled = false;
            isWaiting = false;
            return;
        }
        
        const endTime = Date.now();
        const reaction = endTime - startTime;
        
        reactionTime.textContent = reaction;
        
        // Обновляем статистику
        stats.reactionTotalTests++;
        if (reaction < stats.reactionBestTime) {
            stats.reactionBestTime = reaction;
            reactionBest.textContent = reaction;
            
            // Проверяем достижения
            checkAchievement('reaction-beginner');
            checkAchievement('reaction-master');
            
            // Добавляем опыт
            addExperience(20);
        }
        
        saveUserData();
        
        // Сбрасываем игру
        this.style.backgroundColor = primaryColor;
        startBtn.disabled = false;
        isWaiting = false;
        startTime = null;
    });
    break;
